(function($){var geocoder=new google.maps.Geocoder();$.fn.autoGeocoder=function(options){options=$.extend(true,{},$.fn.autoGeocoder.defaults,options||{});this.setupExtras(options.setup||$.fn.autoGeocoder.base,options);this.each(function(){$(this).trigger('auto-geocoder-initialize');});return this;};$.fn.autoGeocoder.base={initialize:[function(options){options.initial.center=new google.maps.LatLng(options.initial.center[0],options.initial.center[1]);this.bind('auto-geocoder-initialize',function(){$(this).trigger('auto-geocoder-createMap');});}],createMap:[function(options){this.bind('auto-geocoder-createMap',function(){var element=$('<div class="jquery-auto-geocoder-map" />');if(options.position=='before'||options.position=='after'){$(this)[options.position](element);}else{$(options.position).append(element);}
$(this).keyup(function(){$(this).trigger('auto-geocoder-onKeyUp');});this.map=new google.maps.Map(element[0],options.initial);});}],onKeyUp:[function(options){this.bind('auto-geocoder-onKeyUp',function(){var self=this;var element=$(this);var address=$.trim(element.val());if(this.timeout){clearTimeout(this.timeout);}
if(this.previousAddress&&this.previousAddress==cleanAddress(address)){return;}
if(address==''){element.trigger('auto-geocoder-onGeocodeResult',[[],'']);return;}
this.timeout=setTimeout(function(){self.previousAddress=cleanAddress(address);geocoder.geocode({address:address},function(results,status){element.trigger('auto-geocoder-onGeocodeResult',[results,status]);});},options.delay);});function cleanAddress(address){return address.replace(/\s+/g,' ').replace(/^\s+/,'').replace(/\s+$/,'').toLowerCase();}}],onGeocodeResponse:[function(options){this.bind('auto-geocoder-onGeocodeResult',function(e,results,status){if(status==google.maps.GeocoderStatus.OK&&status!=google.maps.GeocoderStatus.ZERO_RESULTS){this.map.setZoom(options.success.zoom);this.map.setCenter(results[0].geometry.location);this.marker=this.marker||new google.maps.Marker();this.marker.setPosition(results[0].geometry.location);this.marker.setMap(this.map);$(this).trigger('auto-geocoder-onGeocodeSuccess',[results,status]);}else{if(this.marker){this.marker.setMap(null);delete this.marker;}
this.map.setZoom(options.initial.zoom);this.map.setCenter(options.initial.center);$(this).trigger('auto-geocoder-onGeocodeFailure',[results,status]);}});}],onGeocodeSuccess:[],onGeocodeFailure:[]};$.fn.autoGeocoder.defaults={position:'after',delay:500,success:{zoom:14},initial:{zoom:1,center:[34,0],draggable:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false}};jQuery.fn.setupExtras=function(setup,options){for(property in setup){var self=this;if(setup[property]instanceof Array){for(var i=0;i<setup[property].length;i++){setup[property][i].call(self,options);}}else{setup[property].call(self,options);}}};})(jQuery);
